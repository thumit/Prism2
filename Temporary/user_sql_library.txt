Wei Query
SELECT
SUBSTR(DISTINCT prescription, 1, INSTR(DISTINCT prescription, "_")-1) as CoverType,
SUBSTR(DISTINCT prescription, 3, INSTR(DISTINCT prescription, "_")-1) as SizeClass,
SUM(case when prescription LIKE '%_NG_E%' then 1 else 0 end) NG_E,
SUM(case when prescription LIKE '%_PB_E%' then 1 else 0 end) PB_E,
SUM(case when prescription LIKE '%_GS_E%' then 1 else 0 end) GS_E,
SUM(case when prescription LIKE '%_EA_E%' then 1 else 0 end) EA_E,
SUM(case when prescription LIKE '%_MS_E%' then 1 else 0 end) MS_E,
SUM(case when prescription LIKE '%_BS_E%' then 1 else 0 end) BS_E,
SUM(case when SUBSTR(DISTINCT prescription, 8, INSTR(DISTINCT prescription, "_")-1) LIKE 'E' then 1 else 0 end) Total_Prescriptions
FROM 
(SELECT DISTINCT prescription FROM yield_tables
WHERE prescription LIKE '%_NG_E%'
OR prescription LIKE '%_PB_E%'
OR prescription LIKE '%_GS_E%'
OR prescription LIKE '%_EA_E%'
OR  prescription LIKE '%_MS_E%'
OR prescription LIKE '%_BS_E%')
GROUP BY CoverType, SizeClass
----------
new query
SELECT DISTINCT prescription AS PB_E_prescription, action_type AS final_activity, MIN(CAST(age_class as decimal)) AS min_age_class, MAX(CAST(age_class as decimal)) AS max_age_class, COUNT(action_type) AS total_rows
FROM yield_tables WHERE prescription LIKE '%_PB_E%' GROUP BY prescription;
----------
testing
SELECT DISTINCT prescription AS NG_E_prescription, action_type AS final_activity, MIN(CAST(age_class as decimal)) AS min_age_class, MAX(CAST(age_class as decimal)) AS max_age_class, COUNT(action_type) AS total_rows
FROM yield_tables WHERE prescription LIKE '%_NG_E%' GROUP BY prescription;
----------